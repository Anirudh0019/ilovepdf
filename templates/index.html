<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local PDF Tools</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        header p {
            color: #8892b0;
            font-size: 1.1rem;
        }

        .privacy-badge {
            display: inline-block;
            background: rgba(233, 69, 96, 0.2);
            border: 1px solid #e94560;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .tool-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            border-color: #e94560;
            box-shadow: 0 10px 40px rgba(233, 69, 96, 0.2);
        }

        .tool-card h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tool-card p {
            color: #8892b0;
            font-size: 0.9rem;
        }

        .tool-icon {
            font-size: 1.5rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            font-size: 1.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.7;
        }

        .close-btn:hover {
            opacity: 1;
        }

        /* Form styles */
        .drop-zone {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .drop-zone:hover,
        .drop-zone.dragover {
            border-color: #e94560;
            background: rgba(233, 69, 96, 0.1);
        }

        .drop-zone input {
            display: none;
        }

        .drop-zone label {
            cursor: pointer;
            display: block;
        }

        .file-list {
            margin: 1rem 0;
            max-height: 150px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .file-item button {
            background: none;
            border: none;
            color: #e94560;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #8892b0;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #e94560;
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            color: #fff;
        }

        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            display: none;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 1rem;
            overflow: hidden;
        }

        .progress-bar.active {
            display: block;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            transition: width 0.3s ease;
        }

        .status-message {
            text-align: center;
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
            display: none;
        }

        .status-message.success {
            display: block;
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
        }

        .status-message.error {
            display: block;
            background: rgba(233, 69, 96, 0.2);
            color: #e94560;
        }

        .inline-inputs {
            display: flex;
            gap: 1rem;
        }

        .inline-inputs .form-group {
            flex: 1;
        }

        .preset-section {
            margin-bottom: 1rem;
        }

        .preset-section label {
            display: block;
            margin-bottom: 0.5rem;
            color: #8892b0;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .preset-btn {
            padding: 0.6rem 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-size: 0.85rem;
        }

        .preset-btn:hover {
            border-color: #e94560;
            background: rgba(233, 69, 96, 0.1);
        }

        .preset-btn.active {
            border-color: #e94560;
            background: rgba(233, 69, 96, 0.2);
        }

        .preset-btn .preset-name {
            font-weight: 600;
            display: block;
        }

        .preset-btn .preset-size {
            font-size: 0.75rem;
            color: #8892b0;
        }

        .divider {
            text-align: center;
            color: #8892b0;
            margin: 1rem 0;
            position: relative;
        }

        .divider::before,
        .divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .divider::before { left: 0; }
        .divider::after { right: 0; }

        /* Signature styles */
        .tab-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tab-btn {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #8892b0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            border-color: #e94560;
        }

        .tab-btn.active {
            border-color: #e94560;
            background: rgba(233, 69, 96, 0.2);
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .signature-canvas-container {
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: #fff;
            margin-bottom: 0.5rem;
            position: relative;
        }

        #signature-canvas {
            display: block;
            width: 100%;
            cursor: crosshair;
            touch-action: none;
        }

        .canvas-actions {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .canvas-actions button {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .canvas-actions button:hover {
            border-color: #e94560;
        }

        .position-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .position-btn {
            padding: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: #8892b0;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }

        .position-btn:hover {
            border-color: #e94560;
        }

        .position-btn.active {
            border-color: #e94560;
            background: rgba(233, 69, 96, 0.2);
            color: #fff;
        }

        /* OCR result styles */
        .ocr-result {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .ocr-result pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            font-family: inherit;
            font-size: 0.9rem;
            color: #ccc;
        }

        .copy-btn {
            margin-top: 0.5rem;
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .copy-btn:hover {
            border-color: #e94560;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Local PDF Tools</h1>
            <p>Your private, offline PDF toolkit</p>
            <div class="privacy-badge">
                üîí Files are processed locally and deleted immediately
            </div>
        </header>

        <div class="tools-grid">
            <div class="tool-card" onclick="openModal('merge')">
                <h3><span class="tool-icon">üìë</span> Merge PDFs</h3>
                <p>Combine multiple PDF files into one document</p>
            </div>

            <div class="tool-card" onclick="openModal('split')">
                <h3><span class="tool-icon">‚úÇÔ∏è</span> Split PDF</h3>
                <p>Extract specific pages or split into individual files</p>
            </div>

            <div class="tool-card" onclick="openModal('compress')">
                <h3><span class="tool-icon">üóúÔ∏è</span> Compress PDF</h3>
                <p>Reduce PDF file size while maintaining quality</p>
            </div>

            <div class="tool-card" onclick="openModal('resize-image')">
                <h3><span class="tool-icon">üìê</span> Resize Image</h3>
                <p>Resize images to exact pixel dimensions</p>
            </div>

            <div class="tool-card" onclick="openModal('compress-image')">
                <h3><span class="tool-icon">üñºÔ∏è</span> Compress Image</h3>
                <p>Reduce image file size with quality control</p>
            </div>

            <div class="tool-card" onclick="openModal('watermark')">
                <h3><span class="tool-icon">üíß</span> Watermark PDF</h3>
                <p>Add text watermark to PDF documents</p>
            </div>

            <div class="tool-card" onclick="openModal('word-to-pdf')">
                <h3><span class="tool-icon">üìù</span> Word to PDF</h3>
                <p>Convert Word documents to PDF format</p>
            </div>

            <div class="tool-card" onclick="openModal('pdf-to-images')">
                <h3><span class="tool-icon">üñºÔ∏è</span> PDF to Images</h3>
                <p>Convert PDF pages to PNG or JPG images</p>
            </div>

            <div class="tool-card" onclick="openModal('sign')">
                <h3><span class="tool-icon">‚úçÔ∏è</span> Sign PDF</h3>
                <p>Add your signature to PDF documents</p>
            </div>

            <div class="tool-card" onclick="openModal('ocr')">
                <h3><span class="tool-icon">üîç</span> OCR - Extract Text</h3>
                <p>Extract text from images or scanned PDFs</p>
            </div>
        </div>
    </div>

    <!-- Merge Modal -->
    <div class="modal" id="modal-merge">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìë Merge PDFs</h2>
                <button class="close-btn" onclick="closeModal('merge')">&times;</button>
            </div>
            <form id="form-merge" onsubmit="handleSubmit(event, 'merge')">
                <div class="drop-zone" id="dropzone-merge">
                    <label for="files-merge">
                        <p>üìÅ Drop PDF files here or click to browse</p>
                        <p style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">Select multiple files (min 2)</p>
                    </label>
                    <input type="file" id="files-merge" name="files" accept=".pdf" multiple required>
                </div>
                <div class="file-list" id="filelist-merge"></div>
                <button type="submit" class="btn btn-primary">Merge PDFs</button>
                <div class="progress-bar" id="progress-merge"><div class="progress-bar-fill"></div></div>
                <div class="status-message" id="status-merge"></div>
            </form>
        </div>
    </div>

    <!-- Split Modal -->
    <div class="modal" id="modal-split">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úÇÔ∏è Split PDF</h2>
                <button class="close-btn" onclick="closeModal('split')">&times;</button>
            </div>
            <form id="form-split" onsubmit="handleSubmit(event, 'split')">
                <div class="drop-zone" id="dropzone-split">
                    <label for="file-split">
                        <p>üìÅ Drop PDF file here or click to browse</p>
                    </label>
                    <input type="file" id="file-split" name="file" accept=".pdf" required>
                </div>
                <div class="file-list" id="filelist-split"></div>
                <div class="form-group">
                    <label for="pages-split">Pages (e.g., "all" or "1,3,5-7")</label>
                    <input type="text" id="pages-split" name="pages" value="all" placeholder="all">
                </div>
                <button type="submit" class="btn btn-primary">Split PDF</button>
                <div class="progress-bar" id="progress-split"><div class="progress-bar-fill"></div></div>
                <div class="status-message" id="status-split"></div>
            </form>
        </div>
    </div>

    <!-- Compress PDF Modal -->
    <div class="modal" id="modal-compress">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üóúÔ∏è Compress PDF</h2>
                <button class="close-btn" onclick="closeModal('compress')">&times;</button>
            </div>
            <form id="form-compress" onsubmit="handleSubmit(event, 'compress')">
                <div class="drop-zone" id="dropzone-compress">
                    <label for="file-compress">
                        <p>üìÅ Drop PDF file here or click to browse</p>
                    </label>
                    <input type="file" id="file-compress" name="file" accept=".pdf" required>
                </div>
                <div class="file-list" id="filelist-compress"></div>
                <div class="form-group">
                    <label for="quality-compress">Compression Level</label>
                    <select id="quality-compress" name="quality">
                        <option value="low">Low (smallest file)</option>
                        <option value="medium" selected>Medium (balanced)</option>
                        <option value="high">High (best quality)</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Compress PDF</button>
                <div class="progress-bar" id="progress-compress"><div class="progress-bar-fill"></div></div>
                <div class="status-message" id="status-compress"></div>
            </form>
        </div>
    </div>

    <!-- Resize Image Modal -->
    <div class="modal" id="modal-resize-image">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìê Resize Image</h2>
                <button class="close-btn" onclick="closeModal('resize-image')">&times;</button>
            </div>
            <form id="form-resize-image" onsubmit="handleSubmit(event, 'resize-image')">
                <div class="drop-zone" id="dropzone-resize-image">
                    <label for="file-resize-image">
                        <p>üìÅ Drop image file here or click to browse</p>
                    </label>
                    <input type="file" id="file-resize-image" name="file" accept="image/*" required>
                </div>
                <div class="file-list" id="filelist-resize-image"></div>

                <div class="preset-section">
                    <label>Portrait (vertical)</label>
                    <div class="preset-grid">
                        <button type="button" class="preset-btn" onclick="setResizePreset(600, 800)">
                            <span class="preset-name">Small</span>
                            <span class="preset-size">600 √ó 800</span>
                        </button>
                        <button type="button" class="preset-btn" onclick="setResizePreset(768, 1024)">
                            <span class="preset-name">Medium</span>
                            <span class="preset-size">768 √ó 1024</span>
                        </button>
                        <button type="button" class="preset-btn" onclick="setResizePreset(1080, 1440)">
                            <span class="preset-name">Large</span>
                            <span class="preset-size">1080 √ó 1440</span>
                        </button>
                        <button type="button" class="preset-btn" onclick="setResizePreset(1200, 1600)">
                            <span class="preset-name">XL</span>
                            <span class="preset-size">1200 √ó 1600</span>
                        </button>
                    </div>
                </div>

                <div class="preset-section">
                    <label>Landscape (horizontal)</label>
                    <div class="preset-grid">
                        <button type="button" class="preset-btn" onclick="setResizePreset(800, 600)">
                            <span class="preset-name">Small</span>
                            <span class="preset-size">800 √ó 600</span>
                        </button>
                        <button type="button" class="preset-btn" onclick="setResizePreset(1024, 768)">
                            <span class="preset-name">Medium</span>
                            <span class="preset-size">1024 √ó 768</span>
                        </button>
                        <button type="button" class="preset-btn" onclick="setResizePreset(1920, 1080)">
                            <span class="preset-name">Full HD</span>
                            <span class="preset-size">1920 √ó 1080</span>
                        </button>
                        <button type="button" class="preset-btn" onclick="setResizePreset(2560, 1440)">
                            <span class="preset-name">2K</span>
                            <span class="preset-size">2560 √ó 1440</span>
                        </button>
                    </div>
                </div>

                <div class="preset-section">
                    <label>Square</label>
                    <div class="preset-grid">
                        <button type="button" class="preset-btn" onclick="setResizePreset(500, 500)">
                            <span class="preset-name">Small</span>
                            <span class="preset-size">500 √ó 500</span>
                        </button>
                        <button type="button" class="preset-btn" onclick="setResizePreset(1000, 1000)">
                            <span class="preset-name">Medium</span>
                            <span class="preset-size">1000 √ó 1000</span>
                        </button>
                        <button type="button" class="preset-btn" onclick="setResizePreset(1080, 1080)">
                            <span class="preset-name">Instagram</span>
                            <span class="preset-size">1080 √ó 1080</span>
                        </button>
                        <button type="button" class="preset-btn" onclick="setResizePreset(2000, 2000)">
                            <span class="preset-name">Large</span>
                            <span class="preset-size">2000 √ó 2000</span>
                        </button>
                    </div>
                </div>

                <div class="divider">or custom size</div>

                <div class="inline-inputs">
                    <div class="form-group">
                        <label for="width-resize-image">Width (px)</label>
                        <input type="number" id="width-resize-image" name="width" required min="1">
                    </div>
                    <div class="form-group">
                        <label for="height-resize-image">Height (px)</label>
                        <input type="number" id="height-resize-image" name="height" required min="1">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Resize Image</button>
                <div class="progress-bar" id="progress-resize-image"><div class="progress-bar-fill"></div></div>
                <div class="status-message" id="status-resize-image"></div>
            </form>
        </div>
    </div>

    <!-- Compress Image Modal -->
    <div class="modal" id="modal-compress-image">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üñºÔ∏è Compress Image</h2>
                <button class="close-btn" onclick="closeModal('compress-image')">&times;</button>
            </div>
            <form id="form-compress-image" onsubmit="handleSubmit(event, 'compress-image')">
                <div class="drop-zone" id="dropzone-compress-image">
                    <label for="file-compress-image">
                        <p>üìÅ Drop image file here or click to browse</p>
                    </label>
                    <input type="file" id="file-compress-image" name="file" accept="image/*" required>
                </div>
                <div class="file-list" id="filelist-compress-image"></div>
                <div class="form-group">
                    <label for="quality-compress-image">Quality (1-100)</label>
                    <input type="number" id="quality-compress-image" name="quality" value="85" min="1" max="100">
                </div>
                <button type="submit" class="btn btn-primary">Compress Image</button>
                <div class="progress-bar" id="progress-compress-image"><div class="progress-bar-fill"></div></div>
                <div class="status-message" id="status-compress-image"></div>
            </form>
        </div>
    </div>

    <!-- Watermark Modal -->
    <div class="modal" id="modal-watermark">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üíß Watermark PDF</h2>
                <button class="close-btn" onclick="closeModal('watermark')">&times;</button>
            </div>
            <form id="form-watermark" onsubmit="handleSubmit(event, 'watermark')">
                <div class="drop-zone" id="dropzone-watermark">
                    <label for="file-watermark">
                        <p>üìÅ Drop PDF file here or click to browse</p>
                    </label>
                    <input type="file" id="file-watermark" name="file" accept=".pdf" required>
                </div>
                <div class="file-list" id="filelist-watermark"></div>
                <div class="form-group">
                    <label for="text-watermark">Watermark Text</label>
                    <input type="text" id="text-watermark" name="text" value="CONFIDENTIAL" required>
                </div>
                <div class="form-group">
                    <label for="opacity-watermark">Opacity (0.1 - 1.0)</label>
                    <input type="number" id="opacity-watermark" name="opacity" value="0.3" min="0.1" max="1" step="0.1">
                </div>
                <button type="submit" class="btn btn-primary">Add Watermark</button>
                <div class="progress-bar" id="progress-watermark"><div class="progress-bar-fill"></div></div>
                <div class="status-message" id="status-watermark"></div>
            </form>
        </div>
    </div>

    <!-- Word to PDF Modal -->
    <div class="modal" id="modal-word-to-pdf">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìù Word to PDF</h2>
                <button class="close-btn" onclick="closeModal('word-to-pdf')">&times;</button>
            </div>
            <form id="form-word-to-pdf" onsubmit="handleSubmit(event, 'word-to-pdf')">
                <div class="drop-zone" id="dropzone-word-to-pdf">
                    <label for="file-word-to-pdf">
                        <p>üìÅ Drop Word file here or click to browse</p>
                        <p style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">.docx files supported</p>
                    </label>
                    <input type="file" id="file-word-to-pdf" name="file" accept=".docx" required>
                </div>
                <div class="file-list" id="filelist-word-to-pdf"></div>
                <button type="submit" class="btn btn-primary">Convert to PDF</button>
                <div class="progress-bar" id="progress-word-to-pdf"><div class="progress-bar-fill"></div></div>
                <div class="status-message" id="status-word-to-pdf"></div>
            </form>
        </div>
    </div>

    <!-- PDF to Images Modal -->
    <div class="modal" id="modal-pdf-to-images">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üñºÔ∏è PDF to Images</h2>
                <button class="close-btn" onclick="closeModal('pdf-to-images')">&times;</button>
            </div>
            <form id="form-pdf-to-images" onsubmit="handleSubmit(event, 'pdf-to-images')">
                <div class="drop-zone" id="dropzone-pdf-to-images">
                    <label for="file-pdf-to-images">
                        <p>üìÅ Drop PDF file here or click to browse</p>
                    </label>
                    <input type="file" id="file-pdf-to-images" name="file" accept=".pdf" required>
                </div>
                <div class="file-list" id="filelist-pdf-to-images"></div>
                <div class="inline-inputs">
                    <div class="form-group">
                        <label for="format-pdf-to-images">Format</label>
                        <select id="format-pdf-to-images" name="format">
                            <option value="png">PNG</option>
                            <option value="jpeg">JPEG</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dpi-pdf-to-images">DPI</label>
                        <input type="number" id="dpi-pdf-to-images" name="dpi" value="150" min="72" max="600">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Convert to Images</button>
                <div class="progress-bar" id="progress-pdf-to-images"><div class="progress-bar-fill"></div></div>
                <div class="status-message" id="status-pdf-to-images"></div>
            </form>
        </div>
    </div>

    <!-- Sign PDF Modal -->
    <div class="modal" id="modal-sign">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úçÔ∏è Sign PDF</h2>
                <button class="close-btn" onclick="closeModal('sign')">&times;</button>
            </div>

            <div class="drop-zone" id="dropzone-sign">
                <label for="file-sign">
                    <p>üìÅ Drop PDF file here or click to browse</p>
                </label>
                <input type="file" id="file-sign" name="file" accept=".pdf" required>
            </div>
            <div class="file-list" id="filelist-sign"></div>

            <div class="tab-buttons">
                <button type="button" class="tab-btn active" onclick="switchSignTab('type')">Type Signature</button>
                <button type="button" class="tab-btn" onclick="switchSignTab('draw')">Draw Signature</button>
            </div>

            <!-- Type Signature Tab -->
            <div class="tab-content active" id="tab-type">
                <form id="form-sign-text" onsubmit="handleSignSubmit(event, 'text')">
                    <div class="form-group">
                        <label for="signature-text">Your Signature</label>
                        <input type="text" id="signature-text" name="text" placeholder="John Doe" required>
                    </div>
                    <div class="form-group">
                        <label for="font-size-sign">Font Size</label>
                        <input type="number" id="font-size-sign" name="font_size" value="24" min="12" max="72">
                    </div>
                    <div class="form-group">
                        <label>Position</label>
                        <div class="position-grid">
                            <button type="button" class="position-btn" onclick="setSignPosition('top-left')">Top Left</button>
                            <button type="button" class="position-btn" onclick="setSignPosition('top-center')">Top Center</button>
                            <button type="button" class="position-btn" onclick="setSignPosition('top-right')">Top Right</button>
                            <button type="button" class="position-btn" onclick="setSignPosition('bottom-left')">Bottom Left</button>
                            <button type="button" class="position-btn" onclick="setSignPosition('bottom-center')">Bottom Center</button>
                            <button type="button" class="position-btn active" onclick="setSignPosition('bottom-right')">Bottom Right</button>
                        </div>
                        <input type="hidden" id="position-text" name="position" value="bottom-right">
                    </div>
                    <div class="form-group">
                        <label for="pages-sign-text">Apply to Pages</label>
                        <select id="pages-sign-text" name="pages">
                            <option value="last">Last page only</option>
                            <option value="first">First page only</option>
                            <option value="all">All pages</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="include-date-text" name="include_date" style="width: auto;">
                            Include date
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary">Sign PDF</button>
                    <div class="progress-bar" id="progress-sign-text"><div class="progress-bar-fill"></div></div>
                    <div class="status-message" id="status-sign-text"></div>
                </form>
            </div>

            <!-- Draw Signature Tab -->
            <div class="tab-content" id="tab-draw">
                <form id="form-sign-draw" onsubmit="handleSignSubmit(event, 'draw')">
                    <div class="signature-canvas-container">
                        <canvas id="signature-canvas" width="440" height="150"></canvas>
                    </div>
                    <div class="canvas-actions">
                        <button type="button" onclick="clearSignatureCanvas()">Clear</button>
                        <button type="button" onclick="undoSignature()">Undo</button>
                    </div>
                    <div class="form-group">
                        <label>Position</label>
                        <div class="position-grid">
                            <button type="button" class="position-btn pos-draw" onclick="setSignPositionDraw('top-left')">Top Left</button>
                            <button type="button" class="position-btn pos-draw" onclick="setSignPositionDraw('top-center')">Top Center</button>
                            <button type="button" class="position-btn pos-draw" onclick="setSignPositionDraw('top-right')">Top Right</button>
                            <button type="button" class="position-btn pos-draw" onclick="setSignPositionDraw('bottom-left')">Bottom Left</button>
                            <button type="button" class="position-btn pos-draw" onclick="setSignPositionDraw('bottom-center')">Bottom Center</button>
                            <button type="button" class="position-btn pos-draw active" onclick="setSignPositionDraw('bottom-right')">Bottom Right</button>
                        </div>
                        <input type="hidden" id="position-draw" name="position" value="bottom-right">
                    </div>
                    <div class="form-group">
                        <label for="sig-width">Signature Size</label>
                        <input type="number" id="sig-width" name="sig_width" value="150" min="50" max="300">
                    </div>
                    <div class="form-group">
                        <label for="pages-sign-draw">Apply to Pages</label>
                        <select id="pages-sign-draw" name="pages">
                            <option value="last">Last page only</option>
                            <option value="first">First page only</option>
                            <option value="all">All pages</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="include-date-draw" name="include_date" style="width: auto;">
                            Include date
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary">Sign PDF</button>
                    <div class="progress-bar" id="progress-sign-draw"><div class="progress-bar-fill"></div></div>
                    <div class="status-message" id="status-sign-draw"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- OCR Modal -->
    <div class="modal" id="modal-ocr">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîç OCR - Extract Text</h2>
                <button class="close-btn" onclick="closeModal('ocr')">&times;</button>
            </div>
            <form id="form-ocr" onsubmit="handleOcrSubmit(event)">
                <div class="drop-zone" id="dropzone-ocr">
                    <label for="file-ocr">
                        <p>üìÅ Drop image or PDF here</p>
                        <p style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">PNG, JPG, or scanned PDF</p>
                    </label>
                    <input type="file" id="file-ocr" name="file" accept="image/*,.pdf" required>
                </div>
                <div class="file-list" id="filelist-ocr"></div>
                <div class="form-group">
                    <label for="language-ocr">Language</label>
                    <select id="language-ocr" name="language">
                        <option value="eng">English</option>
                        <option value="fra">French</option>
                        <option value="deu">German</option>
                        <option value="spa">Spanish</option>
                        <option value="ita">Italian</option>
                        <option value="por">Portuguese</option>
                        <option value="nld">Dutch</option>
                        <option value="rus">Russian</option>
                        <option value="chi_sim">Chinese (Simplified)</option>
                        <option value="chi_tra">Chinese (Traditional)</option>
                        <option value="jpn">Japanese</option>
                        <option value="kor">Korean</option>
                        <option value="ara">Arabic</option>
                        <option value="hin">Hindi</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Extract Text</button>
                <div class="progress-bar" id="progress-ocr"><div class="progress-bar-fill"></div></div>
                <div class="status-message" id="status-ocr"></div>
                <div class="ocr-result" id="ocr-result" style="display: none;">
                    <pre id="ocr-text"></pre>
                    <button type="button" class="copy-btn" onclick="copyOcrText()">Copy to Clipboard</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // File storage for each tool
        const fileStorage = {};

        function openModal(tool) {
            document.getElementById(`modal-${tool}`).classList.add('active');
            fileStorage[tool] = [];
            updateFileList(tool);
        }

        function closeModal(tool) {
            document.getElementById(`modal-${tool}`).classList.remove('active');
            document.getElementById(`status-${tool}`).className = 'status-message';
            document.getElementById(`status-${tool}`).textContent = '';
            document.getElementById(`progress-${tool}`).classList.remove('active');
            fileStorage[tool] = [];
            updateFileList(tool);
            // Reset form
            document.getElementById(`form-${tool}`).reset();
        }

        function updateFileList(tool) {
            const listEl = document.getElementById(`filelist-${tool}`);
            if (!fileStorage[tool] || fileStorage[tool].length === 0) {
                listEl.innerHTML = '';
                return;
            }

            listEl.innerHTML = fileStorage[tool].map((file, index) => `
                <div class="file-item">
                    <span>${file.name} (${(file.size / 1024).toFixed(1)} KB)</span>
                    <button type="button" onclick="removeFile('${tool}', ${index})">‚úï</button>
                </div>
            `).join('');
        }

        function removeFile(tool, index) {
            fileStorage[tool].splice(index, 1);
            updateFileList(tool);
        }

        // Set resize presets
        function setResizePreset(width, height) {
            document.getElementById('width-resize-image').value = width;
            document.getElementById('height-resize-image').value = height;

            // Update active state on preset buttons
            document.querySelectorAll('#modal-resize-image .preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.preset-btn').classList.add('active');
        }

        // Setup drag and drop for all tools
        document.querySelectorAll('.drop-zone').forEach(zone => {
            const tool = zone.id.replace('dropzone-', '');
            const input = zone.querySelector('input[type="file"]');

            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('dragover');
            });

            zone.addEventListener('dragleave', () => {
                zone.classList.remove('dragover');
            });

            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                if (input.multiple) {
                    fileStorage[tool] = [...(fileStorage[tool] || []), ...files];
                } else {
                    fileStorage[tool] = files.slice(0, 1);
                }
                updateFileList(tool);
            });

            input.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                if (input.multiple) {
                    fileStorage[tool] = [...(fileStorage[tool] || []), ...files];
                } else {
                    fileStorage[tool] = files;
                }
                updateFileList(tool);
            });
        });

        async function handleSubmit(event, tool) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            const statusEl = document.getElementById(`status-${tool}`);
            const progressEl = document.getElementById(`progress-${tool}`);
            const progressFill = progressEl.querySelector('.progress-bar-fill');
            const submitBtn = form.querySelector('button[type="submit"]');

            // Add files from storage
            if (fileStorage[tool] && fileStorage[tool].length > 0) {
                // Clear any existing file entries
                formData.delete('file');
                formData.delete('files');

                if (tool === 'merge') {
                    fileStorage[tool].forEach(file => {
                        formData.append('files', file);
                    });
                } else {
                    formData.set('file', fileStorage[tool][0]);
                }
            }

            // Validate files
            if (tool === 'merge' && (!fileStorage[tool] || fileStorage[tool].length < 2)) {
                statusEl.className = 'status-message error';
                statusEl.textContent = 'Please select at least 2 PDF files';
                return;
            }

            if (tool !== 'merge' && (!fileStorage[tool] || fileStorage[tool].length === 0)) {
                statusEl.className = 'status-message error';
                statusEl.textContent = 'Please select a file';
                return;
            }

            submitBtn.disabled = true;
            progressEl.classList.add('active');
            progressFill.style.width = '30%';
            statusEl.className = 'status-message';
            statusEl.textContent = '';

            try {
                progressFill.style.width = '60%';

                const response = await fetch(`/api/${tool}`, {
                    method: 'POST',
                    body: formData
                });

                progressFill.style.width = '90%';

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Processing failed');
                }

                // Download the file
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;

                // Get filename from Content-Disposition header or use default
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = 'download';
                if (contentDisposition) {
                    const match = contentDisposition.match(/filename="?(.+)"?/);
                    if (match) filename = match[1];
                }
                a.download = filename;

                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                a.remove();

                progressFill.style.width = '100%';
                statusEl.className = 'status-message success';
                statusEl.textContent = 'Done! File downloaded successfully.';

            } catch (error) {
                statusEl.className = 'status-message error';
                statusEl.textContent = error.message;
            } finally {
                submitBtn.disabled = false;
                setTimeout(() => {
                    progressEl.classList.remove('active');
                    progressFill.style.width = '0%';
                }, 1000);
            }
        }

        // Close modal on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    const tool = modal.id.replace('modal-', '');
                    closeModal(tool);
                }
            });
        });

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(modal => {
                    const tool = modal.id.replace('modal-', '');
                    closeModal(tool);
                });
            }
        });

        // ========== OCR Functions ==========
        async function handleOcrSubmit(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            const statusEl = document.getElementById('status-ocr');
            const progressEl = document.getElementById('progress-ocr');
            const progressFill = progressEl.querySelector('.progress-bar-fill');
            const submitBtn = form.querySelector('button[type="submit"]');
            const resultEl = document.getElementById('ocr-result');
            const textEl = document.getElementById('ocr-text');

            // Add file from storage
            if (!fileStorage['ocr'] || fileStorage['ocr'].length === 0) {
                statusEl.className = 'status-message error';
                statusEl.textContent = 'Please select a file';
                return;
            }
            formData.set('file', fileStorage['ocr'][0]);

            submitBtn.disabled = true;
            progressEl.classList.add('active');
            progressFill.style.width = '30%';
            statusEl.className = 'status-message';
            statusEl.textContent = '';
            resultEl.style.display = 'none';

            try {
                progressFill.style.width = '60%';

                const response = await fetch('/api/ocr', {
                    method: 'POST',
                    body: formData
                });

                progressFill.style.width = '90%';

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'OCR failed');
                }

                progressFill.style.width = '100%';

                if (data.text && data.text.trim()) {
                    textEl.textContent = data.text;
                    resultEl.style.display = 'block';
                    statusEl.className = 'status-message success';
                    statusEl.textContent = 'Text extracted successfully!';
                } else {
                    statusEl.className = 'status-message error';
                    statusEl.textContent = 'No text found in the image';
                }

            } catch (error) {
                statusEl.className = 'status-message error';
                statusEl.textContent = error.message;
            } finally {
                submitBtn.disabled = false;
                setTimeout(() => {
                    progressEl.classList.remove('active');
                    progressFill.style.width = '0%';
                }, 1000);
            }
        }

        function copyOcrText() {
            const text = document.getElementById('ocr-text').textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = originalText, 2000);
            });
        }

        // ========== Signature Canvas ==========
        let signatureCanvas, signatureCtx;
        let isDrawing = false;
        let signatureHistory = [];

        function initSignatureCanvas() {
            signatureCanvas = document.getElementById('signature-canvas');
            if (!signatureCanvas) return;

            signatureCtx = signatureCanvas.getContext('2d');
            signatureCtx.strokeStyle = '#000';
            signatureCtx.lineWidth = 2;
            signatureCtx.lineCap = 'round';
            signatureCtx.lineJoin = 'round';

            // Mouse events
            signatureCanvas.addEventListener('mousedown', startDrawing);
            signatureCanvas.addEventListener('mousemove', draw);
            signatureCanvas.addEventListener('mouseup', stopDrawing);
            signatureCanvas.addEventListener('mouseout', stopDrawing);

            // Touch events
            signatureCanvas.addEventListener('touchstart', handleTouchStart);
            signatureCanvas.addEventListener('touchmove', handleTouchMove);
            signatureCanvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            signatureCtx.beginPath();
            const rect = signatureCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            signatureCtx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = signatureCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            signatureCtx.lineTo(x, y);
            signatureCtx.stroke();
        }

        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                // Save state for undo
                signatureHistory.push(signatureCanvas.toDataURL());
                if (signatureHistory.length > 20) signatureHistory.shift();
            }
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = signatureCanvas.getBoundingClientRect();
            isDrawing = true;
            signatureCtx.beginPath();
            signatureCtx.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!isDrawing) return;
            const touch = e.touches[0];
            const rect = signatureCanvas.getBoundingClientRect();
            signatureCtx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
            signatureCtx.stroke();
        }

        function clearSignatureCanvas() {
            if (signatureCtx) {
                signatureCtx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
                signatureHistory = [];
            }
        }

        function undoSignature() {
            if (signatureHistory.length > 1) {
                signatureHistory.pop(); // Remove current state
                const prevState = signatureHistory[signatureHistory.length - 1];
                const img = new Image();
                img.onload = () => {
                    signatureCtx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
                    signatureCtx.drawImage(img, 0, 0);
                };
                img.src = prevState;
            } else {
                clearSignatureCanvas();
            }
        }

        // Initialize canvas when modal opens
        const originalOpenModal = openModal;
        openModal = function(tool) {
            originalOpenModal(tool);
            if (tool === 'sign') {
                setTimeout(initSignatureCanvas, 100);
            }
        };

        // ========== Signature Tab Switching ==========
        function switchSignTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            if (tab === 'type') {
                document.querySelector('.tab-btn:first-child').classList.add('active');
                document.getElementById('tab-type').classList.add('active');
            } else {
                document.querySelector('.tab-btn:last-child').classList.add('active');
                document.getElementById('tab-draw').classList.add('active');
                setTimeout(initSignatureCanvas, 100);
            }
        }

        // ========== Position Selection ==========
        function setSignPosition(position) {
            document.querySelectorAll('#tab-type .position-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('position-text').value = position;
        }

        function setSignPositionDraw(position) {
            document.querySelectorAll('.pos-draw').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('position-draw').value = position;
        }

        // ========== Sign Form Submission ==========
        async function handleSignSubmit(event, type) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            const statusEl = document.getElementById(`status-sign-${type}`);
            const progressEl = document.getElementById(`progress-sign-${type}`);
            const progressFill = progressEl.querySelector('.progress-bar-fill');
            const submitBtn = form.querySelector('button[type="submit"]');

            // Add file from storage
            if (!fileStorage['sign'] || fileStorage['sign'].length === 0) {
                statusEl.className = 'status-message error';
                statusEl.textContent = 'Please select a PDF file';
                return;
            }
            formData.set('file', fileStorage['sign'][0]);

            // For draw signature, add canvas data
            if (type === 'draw') {
                const canvasData = signatureCanvas.toDataURL('image/png');
                // Check if canvas is empty
                const emptyCanvas = document.createElement('canvas');
                emptyCanvas.width = signatureCanvas.width;
                emptyCanvas.height = signatureCanvas.height;
                if (canvasData === emptyCanvas.toDataURL('image/png')) {
                    statusEl.className = 'status-message error';
                    statusEl.textContent = 'Please draw your signature first';
                    return;
                }
                formData.set('signature', canvasData);
            }

            // Handle checkbox
            const includeDateCheckbox = document.getElementById(`include-date-${type}`);
            formData.set('include_date', includeDateCheckbox.checked ? 'true' : 'false');

            submitBtn.disabled = true;
            progressEl.classList.add('active');
            progressFill.style.width = '30%';
            statusEl.className = 'status-message';
            statusEl.textContent = '';

            try {
                progressFill.style.width = '60%';

                const endpoint = type === 'text' ? '/api/sign-text' : '/api/sign-image';
                const response = await fetch(endpoint, {
                    method: 'POST',
                    body: formData
                });

                progressFill.style.width = '90%';

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Signing failed');
                }

                // Download the file
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'signed_document.pdf';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                a.remove();

                progressFill.style.width = '100%';
                statusEl.className = 'status-message success';
                statusEl.textContent = 'Done! Signed PDF downloaded.';

            } catch (error) {
                statusEl.className = 'status-message error';
                statusEl.textContent = error.message;
            } finally {
                submitBtn.disabled = false;
                setTimeout(() => {
                    progressEl.classList.remove('active');
                    progressFill.style.width = '0%';
                }, 1000);
            }
        }
    </script>
</body>
</html>
